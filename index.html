<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>restlib2 by bruth</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1 class="header">restlib2</h1>
        <p class="header">restlib2 is an HTTP library which simplifies creating dynamic Web resources for Django. restlib2 focuses on embracing HTTP and enables clean transparent implementations of your resources.</p>

        <ul>
          <li class="download"><a class="buttons" href="https://github.com/bruth/restlib2/zipball/master">Download ZIP</a></li>
          <li class="download"><a class="buttons" href="https://github.com/bruth/restlib2/tarball/master">Download TAR</a></li>
          <li><a class="buttons github" href="https://github.com/bruth/restlib2">View On GitHub</a></li>
        </ul>

        <p class="header">This project is maintained by <a class="header name" href="https://github.com/bruth">bruth</a></p>


      </header>
      <section>
        <h1>Django RESTlib: HTTP for Programmers</h1>

<p>RESTlib2 is an HTTP library which simplifies
creating dynamic Web resources in Python. RESTlib2 focuses on embracing
HTTP and enables clean transparent implementations of your resources.</p>

<h2>Why?</h2>

<p>Web frameworks typically layer on the abstractions for handling
the request/response process. These abstractions decrease implementation
transparency and results in fragmented modifications of your response
object.</p>

<p><a href="http://www.djangoproject.com">Django</a>, for example, is a full stack Web framework which has a
<a href="https://docs.djangoproject.com/en/1.3/ref/middleware/">middleware layer</a> that enables processing and/or augmenting the request
and response objects before and after the <em>view</em> (called a controller in
MVC stacks) processes the request. Along with the middleware, there are
<a href="https://docs.djangoproject.com/en/1.3/topics/conditional-view-processing/">numerous</a> <a href="https://docs.djangoproject.com/en/1.3/topics/http/decorators/">decorators</a> which can be used to wrapped the view to
modify the process the request headers or modify the response headers.</p>

<p>Django is not at fault here. It was not designed to provide a REST API
with the notion of a <em>resource</em>. It's background and intent is
to make it trivial to stand up websites and the core developers (and
the community) take an extremely pragmatic approach to achieve this.
That being said, for very simple APIs Django has a few <a href="https://docs.djangoproject.com/en/1.4/topics/http/decorators/#allowed-http-methods">helper functions</a>
for restricting which methods are allowed.</p>

<p>Aside from Django core, <a href="http://django-tastypie.readthedocs.org/en/latest/index.html">django-tastypie</a> is the most popular app that
provides an API for defining resources in Django. Unfortunately, tastypie
has too complicated of an API and too many abstractions to understand
how it works. The developer must work within the confines of this intricate
and arbitrary API, rather than embracing and confidently working with
the inferred <em>API</em> HTTP provides.</p>

<p>RESTlib2 intends to provide a more simple, natural and familiar API for
creating dynamic Web resources in Python.</p>

<h2>Examples</h2>

<p><strong>Barebone Example</strong> (no sugar)</p>

<div class="highlight"><pre><span class="kn">import</span> <span class="nn">json</span>

<span class="k">class</span> <span class="nc">Author</span><span class="p">(</span><span class="n">Resource</span><span class="p">):</span>
    <span class="n">supported_accept_types</span> <span class="o">=</span> <span class="p">[</span><span class="s">'application/json'</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">([{</span>
            <span class="s">'first_name'</span><span class="p">:</span> <span class="s">'John'</span><span class="p">,</span>
            <span class="s">'last_name'</span><span class="p">:</span> <span class="s">'Doe'</span><span class="p">,</span>
            <span class="s">'birth_date'</span><span class="p">:</span> <span class="s">'1954-03-29'</span><span class="p">,</span>
        <span class="p">},</span> <span class="p">{</span>
            <span class="s">'first_name'</span><span class="p">:</span> <span class="s">'Jane'</span><span class="p">,</span>
            <span class="s">'last_name'</span><span class="p">:</span> <span class="s">'Doh'</span><span class="p">,</span>
            <span class="s">'birth_date'</span><span class="p">:</span> <span class="s">'1958-01-13'</span><span class="p">,</span>
        <span class="p">}])</span>
</pre></div>

<ul>
<li>
<code>supported_accept_types</code> defines the supported encoding types and rejects
requests only does not accept <code>application/json</code>
</li>
<li>Since the <code>get</code> method is only defined, <code>post</code>, <code>put</code>, <code>patch</code>, and
<code>delete</code> are not allowed for this resource. <code>head</code> is accessible if
<code>get</code> is defined and <code>options</code> is always available unless the service
is set as unavailable</li>
</ul><h2>Composite Resources</h2>

<p>When designing a REST API, an important decision to make up front is
whether a <em>chatty</em> service is preferred, or a service that requires
more bandwith per request.</p>

<p>The latter of the two is a result of embedding resources in other related
resources. For example, the first response entity below simply has a
reference to the endpoint where author <code>id</code> is available. Thus in order to
get the data about the author, a second request is required.</p>

<p>The second response entity has the author data embedded in the book data.
This will require more bandwith, but will not require subsequent requests.</p>

<div class="highlight"><pre><span class="c1">// Referenced</span>
<span class="p">{</span>
    <span class="s2">"title"</span><span class="o">:</span> <span class="s2">"Learn Python The Hard Way"</span><span class="p">,</span>
    <span class="s2">"publish_date"</span><span class="o">:</span> <span class="s2">"2010-05-01"</span><span class="p">,</span>
    <span class="s2">"author"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">"id"</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">"url"</span><span class="o">:</span> <span class="s2">"http://example.com/author/1"</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Embedded</span>
<span class="p">{</span>
    <span class="s2">"id"</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">"title"</span><span class="o">:</span> <span class="s2">"Learn Python The Hard Way"</span><span class="p">,</span>
    <span class="s2">"publish_date"</span><span class="o">:</span> <span class="s2">"2010-05-01"</span><span class="p">,</span>
    <span class="s2">"author"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">"id"</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">"first_name"</span><span class="o">:</span> <span class="s2">"Zed"</span><span class="p">,</span>
        <span class="s2">"last_name"</span><span class="o">:</span> <span class="s2">"Shaw"</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Deciding whether to embed data in another entity can be answered with a
simple question:</p>

<blockquote>
<p>Is it likely the two entities are represented together in client
applications?</p>
</blockquote>

<p>Note that embedding resources does not preclude resources from having their
own endpoints (as in the first example).</p>

<p>For a large collection of objects, choosing to not embed related resources
results in the client needing to potentially make hundreds or thousands
additional requests.</p>

<p>It is recommended to use <a href="http://bruth.github.com/django-preserialize/">django-preserialize</a>
for easily creating custom nested objects. By default, preserialize will recursively embed
any local fields and local related objects.</p>

<div class="highlight"><pre><span class="kn">from</span> <span class="nn">preserialize.serialize</span> <span class="kn">import</span> <span class="n">serialize</span>
<span class="kn">from</span> <span class="nn">library.models</span> <span class="kn">import</span> <span class="n">Book</span>

<span class="k">class</span> <span class="nc">Author</span><span class="p">(</span><span class="n">Resource</span><span class="p">):</span>
    <span class="n">supported_accept_types</span> <span class="o">=</span> <span class="p">[</span><span class="s">'application/json'</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">serialize</span><span class="p">(</span><span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>

<p>For a bit more control, the fields to be included or excluded can be specified:</p>

<pre><code>from preserialize.serialize import serialize
from library.models import Book

class Author(Resource):
    supported_accept_types = ['application/json']

    def get(self, request):
        author_template = {
            'fields': ['first_name', 'last_name']
        }

        book_template = {
            'fields': ['id', 'title', 'publish_date', 'author']
            # Define the serialization template for the related author
            'related': {
                'author': author_template,
            }
        }
        data = serialize(Book.objects.all(), **book_template)
        return json.dumps(data)
</code></pre>

<h2>Philosophy</h2>

<ul>
<li>
<strong>Be pragmatic.</strong> Don't attempt to solve the world's problems in a single
resource. Each should be written with equal purpose in mind.</li>
<li>
<strong>Keep it simple.</strong> Don't concern yourself with the details until you
absolutely need to. Setting a plethora of headers will only make things
more complicated.</li>
<li>
<strong>Be consistent.</strong> If you make use of HATEOAS (and you should), use it
everywhere it makes sense. Support the same mimetypes across your service.</li>
<li>
<strong>Keep it visible.</strong> Resources should be as <em>visible</em> as possible. Do not
obfuscate or overcomplicate how a request is handled, otherwise processing
becomes non-deterministic.</li>
</ul>
      </section>
      <footer>
        <p><small>Hosted on <a href="https://pages.github.com">GitHub Pages</a> using the Dinky theme</small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
		          <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-33820770-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>